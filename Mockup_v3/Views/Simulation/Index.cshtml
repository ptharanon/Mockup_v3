
@{
    ViewBag.Title = "Simulation";
}

<section class="header" style="margin-bottom:40px"></section>

<!-- Input -->
<div class="inputs col-md-6" style="text-align:center">
    <h2 style="text-align:center">Input</h2><br />
    <div id="inputForm" style="text-align:center">
        @Html.Partial("MotorSelection")
        @Html.Partial("InputSpeed")
        @Html.Partial("InputTorque")
        <!-- Simulate button -->
        <div style="margin:20px">
            <button id="simulate-btn" type="submit" class="btn btn-primary btn-lg">SIMULATE!</button>
        </div>
    </div>
</div>
<!-- Output -->
<div class="outputs col-md-6" style="text-align:center">
    @Html.Partial("Output")
    <!-- Export button -->
    <div style="margin:20px">
        <input type="button" class="btn btn-primary btn-lg" value="EXPORT TO CSV" onclick="location.href='@Url.Action("ExportDataToCsv", "Simulation")'" />
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#simulate-btn').click(function (e) {
            e.preventDefault();
            $.ajax({
                url: '@Url.Action("Simulate", "Simulation")',
                data: { motor: "Motor 1" },
                type: "post",
                dataType: 'json',
                success: function (response) {
                    drawPlot("outputCurrent");
                    drawPlot("outputTorque");
                    drawPlot("outputSpeed");
                    drawPlot("outputVoltage");
                }
            })
        });
    });

    $('#exportcsv-btn').click(function (e) {
        e.preventDefault();
    });

    function drawPlot(plotName) {
        $.ajax({
            url: '@Url.Action("GetPlotData", "Simulation")',
            data: { plotname: plotName },
            type: "get",
            success: function (response) {
                if (plotName == "inputSpeed") {
                    refSpeedPlot.series[0].data = response.signal;
                    refSpeedPlot.replot({ resetAxes: true });
                } else if (plotName == "inputTorque") {
                    loadTorquePlot.series[0].data = response.signal;
                    loadTorquePlot.replot({ resetAxes: true });
                } else if (plotName == "outputCurrent") {
                    outputSCPlot.series[0].data = response.signal;
                    outputSCPlot.replot({ resetAxes: true });
                } else if (plotName == "outputTorque") {
                    outputTorquePlot.series[0].data = response.signal;
                    outputTorquePlot.replot({ resetAxes: true });
                } else if (plotName == "outputSpeed") {
                    outputSpeedPlot.series[0].data = response.signal;
                    outputSpeedPlot.replot({ resetAxes: true });
                } else if (plotName == "outputVoltage") {
                    outputDCVPlot.series[0].data = response.signal;
                    outputDCVPlot.replot({ resetAxes: true });
                }
            }
        })
    }
</script>